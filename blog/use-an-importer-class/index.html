<html><head><title>Use an Importer Class | Dave Woodall</title><meta charset=utf-8 /><link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css" rel=stylesheet /><script src="../../scripts/lib/lodash.min.js"></script><script src="../../scripts/lib/jquery.min.js"></script><script src="../../scripts/lib/modernizer.js"></script><script src="../../scripts/script.js"></script><meta content="initial-scale=1.0" name=viewport /><meta content="Use an Importer Class" property="og:title"/><meta content="Dave Woodall" property="og:site_name"/><meta content="http://wwwoodall.com" property="og:url"/><meta content=summary_large_image name="twitter:card"/><meta content="@wwwoodall" name="twitter:site"/><meta content="@wwwoodall" name="twitter:creator"/><meta content="Importing data from strangers into your database should be done with care." property="og:description"/><meta content="Importing data from strangers into your database should be done with care." name="twitter:description"/></head><link href="../../stylesheets/application.css" media=screen rel=stylesheet /><body><div class=l-header><nav class=left-nav><div class=bio-pic><img src="../../images/dave_woodall.jpg"/></div><p><a href="/about-dave">Dave Woodall</a></p><div class=bio>Christian, Husband, Dad, Developer, Designer, Drawer, Inventor, INTJ, Reader, Writer, French press Snowboard then beers.</div><div class=location>Boulder, CO</div><ul><li><a class="" href="/feed/">feed</a></li><li><a class="" href="/jots/">jots</a></li><li><a class="" href="/gifs/">gifs</a></li><li><a class="" href="/pictures/">pictures</a></li><li><a class="" href="/watching/">watching</a></li><li><a class=" active" href="/blog/">blog</a></li><li><a class="" href="/questions/">questions</a></li><li><a class="" href="/notes/">notes</a></li><li><a class="" href="/reading/">reading</a></li><li><a class="" href="/links/">links</a></li></ul></nav></div><div class=l-container><article class=type-system-traditional><p class=type><a href="/blog">all posts</a> >> <a href="/hashpage">HashPage</a></p><h1>Use an Importer Class</h1><p class=date>Jun 22, 2015</p><p>Importing data from strangers into your database should be done with care. The task is to convert data from what we get into what we want. Today I learned about doing so with an Importer Class. Here's how I learned it.</p> <p>I'm building <a href="//www.hashpage.me">hashPage</a> to use Twitter as a CMS by getting all the tweets from a user. I need a lot but not all the tweet data. I'm storing tweets in a <code>RawTweet</code> class. At first, I was doing it like so;</p> <pre class="highlight plaintext"><code>tweets = client.get_all_tweets(params[:user])
tweets.each do |t|
  RawTweet.create(
      tweet_id: t.id,
      user_id: t.user.id,
      username: t.user.screen_name
  )
end
</code></pre> <p>The problem with this is the code is it's doing two things at once, getting the tweets and importing them at the same time. This is not respecting the import process as much as I should be. <a href="//www.twitter.com/tcopeland">Tom Copeland</a> showed me that what I need to do is create an Importer Class and iterate over that instead. Like so;</p> <pre class="highlight plaintext"><code>tweets.each do |t|
  TwitterImporter.new(t).import!
end
</code></pre> <p>Then, I can do whatever I need and manage whatever changes come when importing from this service.</p> <pre class="highlight plaintext"><code>class TwitterImporter
  attr_reader :tweet

  def initialize(tweet)
    @tweet = tweet
  end

  def import!
    RawTweet.create( 
      tweet_id: tweet.id,
      user_id: tweet.user.id,
      username: tweet.user.screen_name
    )
  end
end
</code></pre> <p>Much better. Thanks, Tom!</p> <link href="//cdn-images.mailchimp.com/embedcode/classic-081711.css" rel=stylesheet><style>#mc_embed_signup background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;
/!* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */</style><div id=mc_embed_signup><form action="//lettucebooks.us8.list-manage.com/subscribe/post?u=42150f382a237947f46c88221&amp;id=49f1ff76a7" class=validate id=mc-embedded-subscribe-form method=post name=mc-embedded-subscribe-form novalidate="" target=_blank><div id=mc_embed_signup_scroll><div class=mc-field-group><label for=mce-EMAIL>Stay updated!</label><input class="required email" id=mce-EMAIL name=EMAIL type=email value="email address"/></div><div class=clear id=mce-responses><div class=response id=mce-error-response style="display:none"></div><div class=response id=mce-success-response style="display:none"></div></div><div style="position: absolute; left: -5000px;"><input name=b_42150f382a237947f46c88221_49f1ff76a7 tabindex=-1 value=""/></div><div class=clear><input class=button id=mc-embedded-subscribe name=subscribe type=submit value=Subscribe /></div></div></form></div><script src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script>| (function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);  / End mc_embed_signup</script></link><div id=disqus_thread></div><script>var disqus_shortname = 'wwwoodall';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></script><hr/></article></div><div class=extra-posts><div class=l-container><div class=intro-text><h2>More from</h2><h3>HashPage</h3></div><article class="type-system-traditional extra-post"><h2><a href="/blog/use-different-layouts-in-rails/">Use different layouts in Rails</a></h2><p><p><a href="//www.hashpage.me">hashpage</a> will be offering different page themes based on a tweet. For example a tweet might look like;</p> <blockquote class=twitter-tweet lang=en> <p lang=en dir=ltr>List Light Newspaper <a href="https://twitter.com/hashtag/theme?src=hash">#theme</a></p>â€” dave woodall (@wwwoodall) <a href="https://twitter.com/wwwoodall/status/618834960032661504">July 8, 2015</a> </blockquote> <script async="" src="//platform.twitter.com/widgets.js" charset=utf-8></script> <p>At first, I imagined having a single application and similar DOM that would...</p></p></article><article class="type-system-traditional extra-post"><h2><a href="/blog/the-benefit-of-a-presenter-object/">the benefit of a presenter object</a></h2><p><p>I've heard about Presenter Objects but hadn't seen a need for them until recently. Most of the time I make a specific query on Active Record as simple and direct as passing my Model unfiltered to the View and putting some logic into the controller...</p></p></article><article class="type-system-traditional extra-post"><h2><a href="/blog/testing-twitter/">testing twitter</a></h2><p><p>I was able to get my first contact with Twitter with Sferik's <a href="https://github.com/sferik/twitter">Twitter gem</a>. It was surprisingly simple to get started.</p> <h3 id=review-progress-up-to-this-point>Review progress up to this point.</h3> <p>In order to get this to work, I had to return to the topic of managing environment variables....</p></p></article><article class="type-system-traditional extra-post"><h2><a href="/blog/my-first-hackathon/">My first hackathon</a></h2><p><p>My first hackathon at <a href="//www.starterleague.com">starter league</a> was an idea to create a page based off hashtags you use most often on twitter. We called it a hashpage. There were 5 of us on the founding team and we had a weekend to build it.</p> <blockquote class=twitter-tweet lang=en><p>HashPageMe founding team! <a href="https://twitter.com/hashtag/cahack?src=hash">#cahack</a></p></blockquote></p></article></div></div></body><footer class=footer><div class=footer-links><ul><li><h5><a href="/">wwwoodall</a></h5></li><li>by Dave Woodall</li><li>Boulder, CO</li><li><h3 class="fa fa-phone"> Contact</h3></li><li><a class="fa fa-envelope-o" href="mailto:dave@woodalls.me"> email</a></li><li><a target=_blank href="//www.twitter.com/wwwoodall"><div class="fa fa-twitter"></div> <span>twitter</span></a></li><li><a target=_blank href="//www.github.com/woodall"><div class="fa fa-github"></div> <span>github</span></a></li><li><a target=_blank href="//www.dribbble.com/wwwoodall"><div class="fa fa-dribbble"></div> <span>dribbble</span></a></li></ul><ul><li><h3 class="fa fa-paper-plane"> fun</h3></li><ul><li><a class="" href="/feed/">feed</a></li><li><a class="" href="/jots/">jots</a></li><li><a class="" href="/gifs/">gifs</a></li><li><a class="" href="/pictures/">pictures</a></li><li><a class="" href="/watching/">watching</a></li><li><a class=" active" href="/blog/">blog</a></li><li><a class="" href="/questions/">questions</a></li><li><a class="" href="/notes/">notes</a></li><li><a class="" href="/reading/">reading</a></li><li><a class="" href="/links/">links</a></li></ul></ul><ul><li><h3 class="fa fa-flask"> apps</h3></li><li><a href="//www.destroyalltasks.com">#TODO</a></li><li><a href="//www.fakefarm.com">fake farm</a></li><li><a href="//www.hashpage.me">hash page</a></li></ul></div></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-52536027-1', 'auto');
ga('send', 'pageview');</script></html>